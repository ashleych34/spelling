<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Spelling Bee Levels</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root { --primary: #007bff; --success: #28a745; --danger: #dc3545; --bg: #f0f8ff; --purple: #6f42c1; }
        body { font-family: -apple-system, system-ui, sans-serif; background-color: var(--bg); display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 20px; box-sizing: border-box; }
        
        .container { width: 100%; max-width: 500px; background: white; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); padding: 20px; text-align: center; position: relative; min-height: 400px; }
        
        h1 { margin: 0 0 15px 0; color: #333; font-size: 1.5rem; }

        /* LEVEL SELECT MENU */
        .level-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .level-btn {
            background: white; border: 2px solid #ddd; border-radius: 15px;
            padding: 20px; font-size: 1.1rem; cursor: pointer;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: transform 0.2s, border-color 0.2s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); color: #555;
        }
        .level-btn:hover { transform: translateY(-3px); border-color: var(--primary); color: var(--primary); }
        .level-btn.completed { border-color: var(--success); background: #f0fff4; }
        .level-title { font-weight: 800; margin-bottom: 5px; }
        .level-score { font-size: 0.85rem; color: #888; font-weight: normal; }
        .level-icon { font-size: 1.5rem; margin-top: 5px; }

        /* QUIZ AREA (Hidden by default) */
        #quizInterface { display: none; }
        
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .btn-back { background: #f8f9fa; border: none; font-size: 0.9rem; padding: 5px 10px; border-radius: 5px; cursor: pointer; color: #666; }
        .score-badge { font-weight: bold; color: var(--primary); background: #e7f1ff; padding: 5px 10px; border-radius: 10px; }

        .definition-box { font-size: 1.2rem; font-weight: 600; color: #222; margin: 20px 0; line-height: 1.4; min-height: 60px; display: flex; align-items: center; justify-content: center; flex-direction: column; }
        .sentence-text { font-size: 1rem; color: #555; font-style: italic; margin-top: 10px; font-weight: normal; }
        
        .options-grid { display: flex; flex-direction: column; gap: 12px; }
        .btn-option {
            background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 12px;
            padding: 15px; font-size: 1.2rem; color: #333; cursor: pointer;
            transition: all 0.2s; font-weight: 600; text-align: left;
        }
        .btn-option:hover { border-color: var(--primary); background: #e7f1ff; }
        .btn-option.correct { background: #d4edda; border-color: var(--success); color: #155724; }
        .btn-option.wrong { background: #f8d7da; border-color: var(--danger); color: #721c24; opacity: 0.7; }
        
        .btn-next {
            margin-top: 20px; padding: 15px 30px; background: var(--primary); color: white;
            border: none; border-radius: 10px; font-size: 1.1rem; font-weight: bold;
            cursor: pointer; width: 100%; display: none;
        }

        .btn-audio { 
            background-color: var(--purple); font-size: 20px; width: 45px; height: 45px; 
            border-radius: 50%; border: none; color: white; cursor: pointer; 
            display: inline-flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        /* End Screen */
        #endScreen { display: none; }
        .final-score { font-size: 3.5rem; margin: 10px 0; color: var(--primary); }
        .result-msg { font-size: 1.2rem; margin-bottom: 20px; color: #555; }

        .home-link { margin-top: 20px; color: var(--primary); text-decoration: none; font-size: 0.9rem; font-weight: 500; }
    </style>
</head>
<body>

    <div class="container">
        
        <div id="menuScreen">
            <h1>üó∫Ô∏è Select a Level</h1>
            <p style="color:#666; font-size:0.9rem;">Master 10 words at a time!</p>
            <div class="level-grid" id="levelGrid">
                </div>
            <div style="margin-top:20px;">
                <button onclick="resetAllProgress()" style="background:none; border:none; color:#aaa; font-size:0.8rem; cursor:pointer; text-decoration:underline;">Reset All Progress</button>
            </div>
        </div>

        <div id="quizInterface">
            <div class="top-bar">
                <button class="btn-back" onclick="showMenu()">‚Üê Menu</button>
                <div id="levelIndicator" style="font-weight:bold; color:#333;">Level 1</div>
                <div class="score-badge" id="liveScore">0/10</div>
            </div>

            <div id="gameArea">
                <button class="btn-audio" onclick="speakWord()" title="Listen">üîä</button>
                <div class="definition-box">
                    <span id="defText">Loading...</span>
                    <span id="sentText" class="sentence-text"></span>
                </div>
                <div class="options-grid" id="optionsGrid"></div>
                <button class="btn-next" id="nextBtn" onclick="nextQuestion()">Next Word ‚û°Ô∏è</button>
            </div>
        </div>

        <div id="endScreen">
            <h2 id="endTitle">üéâ Level Complete!</h2>
            <div class="final-score" id="finalScoreDisplay">0/10</div>
            <p class="result-msg" id="resultMsg">Great job!</p>
            <button class="btn-next" style="display:block;" onclick="showMenu()">Back to Map üó∫Ô∏è</button>
            <button class="btn-next" style="display:block; background:#6c757d; margin-top:10px;" onclick="restartLevel()">Try Level Again üîÑ</button>
        </div>

    </div>

    <a href="index.html" class="home-link">‚Üê Back to Flashcards</a>

    <script>
        // --- DATA: FULL 50 WORDS ---
        const fullWordList = [
            {w: "hesitate", d: "To pause before you do something because you are unsure.", s: "Please do not _______ to ask for help."},
            {w: "fragments", d: "Small broken parts or pieces of something.", s: "The vase broke into many _______."},
            {w: "ration", d: "A fixed amount of something officially allowed to each person.", s: "We had to _______ our water during the hike."},
            {w: "frustration", d: "The feeling of being upset because you cannot do something.", s: "He cried in _______ when he couldn't solve the puzzle."},
            {w: "aroma", d: "A pleasant, noticeable smell.", s: "The _______ of fresh bread filled the kitchen."},
            {w: "perfume", d: "A liquid that has a sweet, pleasant smell.", s: "My mother wears flower-scented _______."},
            {w: "discoveries", d: "Things found or learned for the first time.", s: "Scientific _______ help us understand the world."},
            {w: "prognosis", d: "A doctor's opinion of how an illness will develop.", s: "The doctor's _______ was very positive."},
            {w: "gallop", d: "The fastest pace of a horse.", s: "The horses began to _______ across the field."},
            {w: "fluently", d: "Able to speak or write a language easily.", s: "She speaks Spanish _______."},
            
            {w: "sardines", d: "Small, silvery fish often packed in cans.", s: "Some people enjoy eating _______ on crackers."},
            {w: "rickety", d: "Not strong or stable; likely to break.", s: "The _______ old bridge swayed in the wind."},
            {w: "porridge", d: "A soft food made by boiling oats in water or milk.", s: "Goldilocks ate the _______."},
            {w: "beige", d: "A very light brown or yellowish-gray color.", s: "The walls are painted a soft _______."},
            {w: "gaunt", d: "Very thin, especially because of hunger.", s: "The stray dog looked _______ and tired."},
            {w: "nautical", d: "Relating to sailors, ships, or navigation.", s: "The room had many _______ decorations."},
            {w: "foreign", d: "From a country other than your own.", s: "Learning a _______ language is rewarding."},
            {w: "scorcher", d: "A very hot day.", s: "Today is a real _______!"},
            {w: "deflated", d: "Having let the air out of something.", s: "My basketball is _______ and won't bounce."},
            {w: "cosmetics", d: "Products used to improve appearance.", s: "Lipsticks are types of _______."},
            
            {w: "unruly", d: "Difficult to control or manage.", s: "The wind made my hair very _______."},
            {w: "moustache", d: "Hair grown on a man's upper lip.", s: "He has a thick, white _______."},
            {w: "sinister", d: "Giving the impression that something evil will happen.", s: "The villain had a _______ laugh."},
            {w: "lurches", d: "To make an abrupt, unsteady movement.", s: "The bus _______ forward when it starts."},
            {w: "Buffalo", d: "A large wild animal of the cow family.", s: "We saw a herd of _______."},
            {w: "fabulous", d: "Extraordinary; especially good.", s: "You did a _______ job!"},
            {w: "mysterious", d: "Difficult or impossible to understand.", s: "A _______ box was on our doorstep."},
            {w: "anguish", d: "Severe mental or physical pain.", s: "She felt _______ when she lost her cat."},
            {w: "lilt", d: "A characteristic rising and falling of the voice.", s: "She speaks with a cheerful _______."},
            {w: "democracy", d: "A system of government where people vote.", s: "In a _______, people vote for leaders."},
            
            {w: "ancestral", d: "Belonging to or inherited from ancestors.", s: "This is an _______ heirloom."},
            {w: "enormous", d: "Very large in size or quantity.", s: "The elephant ate an _______ amount."},
            {w: "dubious", d: "Hesitating or doubting.", s: "I was _______ about his strange story."},
            {w: "scavenger", d: "An animal that feeds on dead matter.", s: "A vulture is a well-known _______."},
            {w: "unleash", d: "To release a strong force or emotion.", s: "Don't _______ the dog in the park."},
            {w: "crawdad", d: "A freshwater animal like a small lobster.", s: "We caught a _______ in the creek."},
            {w: "mascot", d: "A character supposed to bring good luck.", s: "The school's _______ is a tiger."},
            {w: "artifacts", d: "Objects made by humans from the past.", s: "The museum has ancient _______."},
            {w: "tuxedo", d: "A man's formal suit for the evening.", s: "He wore a _______ to the wedding."},
            {w: "language", d: "The method of human communication.", s: "English is a common _______."},
            
            {w: "sequins", d: "Small, shiny disks sewn onto clothing.", s: "Her dress was covered in _______."},
            {w: "lanky", d: "Tall and thin with long limbs.", s: "The _______ player reached the hoop easily."},
            {w: "brandished", d: "Waved something in excitement or threat.", s: "The knight _______ his sword."},
            {w: "conical", d: "Shaped like a cone.", s: "The wizard wore a tall, _______ hat."},
            {w: "pediatric", d: "Relating to medical care of children.", s: "He went to the _______ clinic."},
            {w: "rummage", d: "To search messily through a pile.", s: "I had to _______ through my drawer."},
            {w: "grimace", d: "A twisted expression of pain.", s: "She made a _______ when she tasted the lemon."},
            {w: "geranium", d: "A garden plant with red or pink flowers.", s: "My grandma grows a red _______."},
            {w: "ebony", d: "A very dark black color.", s: "The piano has black _______ keys."},
            {w: "paltry", d: "A very small or meager amount.", s: "He got a _______ amount of candy."}
        ];

        // --- APP STATE ---
        const STORAGE_KEY = 'spelling_levels_v1';
        let levelScores = [0, 0, 0, 0, 0]; // Best score for each level
        
        let currentLevel = 0; // 0-4
        let levelWords = [];  // The 10 words for active level
        let shuffledIndices = []; // Indices of levelWords
        let qIndex = 0; // 0-9
        let currentScore = 0;
        let answered = false;

        // --- INIT ---
        function initApp() {
            loadProgress();
            renderMenu();
        }

        function loadProgress() {
            try {
                const saved = localStorage.getItem(STORAGE_KEY);
                if(saved) levelScores = JSON.parse(saved);
            } catch(e) { console.error(e); }
        }

        function saveProgress() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(levelScores));
        }

        function resetAllProgress() {
            if(confirm("Are you sure? This will delete all stars.")) {
                localStorage.removeItem(STORAGE_KEY);
                levelScores = [0, 0, 0, 0, 0];
                renderMenu();
            }
        }

        // --- MENU SCREEN ---
        function renderMenu() {
            document.getElementById('menuScreen').style.display = 'block';
            document.getElementById('quizInterface').style.display = 'none';
            document.getElementById('endScreen').style.display = 'none';
            
            const grid = document.getElementById('levelGrid');
            grid.innerHTML = '';

            for(let i=0; i<5; i++) {
                const btn = document.createElement('div');
                const score = levelScores[i] || 0;
                let statusClass = score >= 7 ? 'completed' : '';
                
                // Icon Logic
                let icon = 'üîí';
                let scoreText = 'Not started';
                
                // Unlock logic: Level 1 always open, others if prev >= 7 (optional, currently all open)
                let isLocked = false; 

                if (score === 10) icon = 'ü•á'; // Gold Medal
                else if (score >= 7) icon = '‚≠êÔ∏è'; // Star
                else if (score > 0) icon = 'üìù'; // In progress
                else icon = 'üìö';

                if (score > 0) scoreText = `Best: ${score}/10`;

                btn.className = `level-btn ${statusClass}`;
                btn.innerHTML = `
                    <div class="level-title">Level ${i+1}</div>
                    <div class="level-score">${scoreText}</div>
                    <div class="level-icon">${icon}</div>
                `;
                btn.onclick = () => startLevel(i);
                grid.appendChild(btn);
            }
        }

        function showMenu() {
            renderMenu();
        }

        // --- GAME LOGIC ---
        function startLevel(levelIndex) {
            currentLevel = levelIndex;
            
            // Slice the main array (0-9, 10-19, etc)
            const start = levelIndex * 10;
            const end = start + 10;
            levelWords = fullWordList.slice(start, end);
            
            // Randomize order within the level
            shuffledIndices = levelWords.map((_, i) => i).sort(() => Math.random() - 0.5);
            
            qIndex = 0;
            currentScore = 0;
            
            document.getElementById('menuScreen').style.display = 'none';
            document.getElementById('endScreen').style.display = 'none';
            document.getElementById('quizInterface').style.display = 'block';
            document.getElementById('levelIndicator').innerText = `Level ${currentLevel + 1}`;
            
            loadQuestion();
        }

        function restartLevel() {
            startLevel(currentLevel);
        }

        function loadQuestion() {
            if (qIndex >= 10) {
                endLevel();
                return;
            }

            answered = false;
            document.getElementById('liveScore').innerText = `${currentScore}/10`;
            document.getElementById('nextBtn').style.display = 'none';

            // Get current word object
            const wordObj = levelWords[shuffledIndices[qIndex]];
            
            document.getElementById('defText').innerText = wordObj.d;
            document.getElementById('sentText').innerText = `"${wordObj.s}"`;

            // Generate Options
            const grid = document.getElementById('optionsGrid');
            grid.innerHTML = '';
            
            let options = generateMisspellings(wordObj.w);
            if(!options.includes(wordObj.w)) options[0] = wordObj.w;
            // Fill if needed
            while(options.length < 4) options.push(wordObj.w + "s");
            // Shuffle
            options.sort(() => Math.random() - 0.5);

            options.forEach(optText => {
                const btn = document.createElement('button');
                btn.className = 'btn-option';
                btn.innerText = optText;
                btn.onclick = () => handleAnswer(btn, optText === wordObj.w, wordObj.w);
                grid.appendChild(btn);
            });
        }

        function handleAnswer(btn, isCorrect, correctWord) {
            if(answered) return;
            answered = true;

            if(isCorrect) {
                btn.classList.add('correct');
                currentScore++;
                triggerConfetti(0.5);
            } else {
                btn.classList.add('wrong');
                // Highlight correct
                const allBtns = document.querySelectorAll('.btn-option');
                allBtns.forEach(b => {
                    if(b.innerText === correctWord) b.classList.add('correct');
                });
            }

            document.getElementById('liveScore').innerText = `${currentScore}/10`;
            document.getElementById('nextBtn').style.display = 'block';
        }

        function nextQuestion() {
            qIndex++;
            loadQuestion();
        }

        function endLevel() {
            document.getElementById('quizInterface').style.display = 'none';
            document.getElementById('endScreen').style.display = 'block';
            
            const prevBest = levelScores[currentLevel] || 0;
            if (currentScore > prevBest) {
                levelScores[currentLevel] = currentScore;
                saveProgress();
            }

            document.getElementById('finalScoreDisplay').innerText = `${currentScore}/10`;
            
            const msg = document.getElementById('resultMsg');
            const title = document.getElementById('endTitle');
            
            if(currentScore === 10) {
                title.innerText = "ü•á Perfect Score!";
                msg.innerText = "You are a Spelling Champion!";
                fireworks();
            } else if (currentScore >= 7) {
                title.innerText = "‚≠êÔ∏è Level Complete!";
                msg.innerText = "Great job! You earned a star.";
                triggerConfetti(1.0);
            } else {
                title.innerText = "Keep Practicing!";
                msg.innerText = "Try again to earn your star.";
            }
        }

        function speakWord() {
            const wordObj = levelWords[shuffledIndices[qIndex]];
            const utterance = new SpeechSynthesisUtterance(wordObj.w);
            utterance.lang = 'en-US';
            utterance.rate = 0.85;
            window.speechSynthesis.speak(utterance);
        }

        // --- UTILS ---
        function generateMisspellings(word) {
            const forms = new Set([word]);
            const transforms = [
                { reg: /a/g, rep: 'e' }, { reg: /e/g, rep: 'a' },
                { reg: /i/g, rep: 'y' }, { reg: /y/g, rep: 'i' },
                { reg: /c/g, rep: 'k' }, { reg: /ph/g, rep: 'f' },
                { reg: /tion/g, rep: 'sion' }, { reg: /ll/g, rep: 'l' },
                { reg: /mm/g, rep: 'm' }, { reg: /ss/g, rep: 's' },
                { reg: /ou/g, rep: 'o' }, { reg: /ie/g, rep: 'ei' }
            ];
            
            let attempts = 0;
            while(forms.size < 4 && attempts < 20) {
                let w = word;
                const t = transforms[Math.floor(Math.random() * transforms.length)];
                if(w.match(t.reg)) {
                    w = w.replace(t.reg, t.rep);
                    if(w !== word) forms.add(w);
                }
                attempts++;
            }
            // Fallbacks
            if(forms.size < 4) forms.add(word.slice(0, -1));
            if(forms.size < 4) forms.add(word + 's');
            if(forms.size < 4) forms.add(word.replace(/[aeiou]/, 'o'));
            
            return Array.from(forms).slice(0, 4);
        }

        function triggerConfetti(ratio) {
            if(typeof confetti === 'function') confetti({ particleCount: 50 * ratio, spread: 70, origin: { y: 0.6 } });
        }

        function fireworks() {
            if(typeof confetti !== 'function') return;
            var duration = 3 * 1000;
            var end = Date.now() + duration;
            (function frame() {
                confetti({ particleCount: 5, angle: 60, spread: 55, origin: { x: 0 } });
                confetti({ particleCount: 5, angle: 120, spread: 55, origin: { x: 1 } });
                if (Date.now() < end) requestAnimationFrame(frame);
            }());
        }

        // START
        initApp();
    </script>
</body>
</html>
